# Roblox COP Chaser Game README

## Overview

This document outlines the architecture of the Roblox COP Chaser game, a multi-place experience with a focus on data persistence, security, and modular design.

***

## Game Architecture

- **Two-Place Structure:** The game is divided into two separate places: the **Lobby** for pre-game activities and the **Teleport** place for the main gameplay. This provides a clean separation of concerns and allows for a more robust and scalable architecture.
- **Universe Sharing:** All places within this experience (Lobby, Game Places, etc.) share the same `DataStore` backend. This allows for seamless data persistence without the need to pass data between places using `TeleportService`.
- **ProfileService:** `ProfileService` is a session-locking `DataStore` wrapper that ensures data integrity and prevents data loss. It works by "locking" a player's profile when they join a server, preventing other servers from writing to their data simultaneously.
- **Modular Design:** Each core script/module serves a clear function, making it easy to extend, upgrade, or swap.

***

## Project Structure

The project is organized into two main folders: `Lobby` and `Teleport`, each containing subdirectories that mirror the Roblox game engine's hierarchy.

### `Lobby`

This folder contains all the scripts and modules necessary for the lobby experience.

*   **`ServerScriptService`:**
    *   **`InventoryService.lua`:** Manages the player's inventory on the server.
    *   **`PlayerManager.lua`:** Manages loading and saving of player data using `ProfileService`.
    *   **`QueueManager.lua`:** Manages matchmaking queues for various game modes.
    *   **`SecurityManager.lua`:** Consolidates all security-related logic.
*   **`ReplicatedStorage/Modules`:**
    *   **`GameConfig.lua`:** A single source of truth for all static config and data.
    *   **`GameStateManager.lua`:** Manages the state of each player.
    *   **`Logger.lua`:** Provides a simple and robust logging system.
    *   **`PlayerDataHandler.lua`:** Defines the data structure for player profiles.
    *   **`ProfileService.lua`:** The core `ProfileService` module.
    *   **`Inventory_Ui/`:**
        *   **`ButtonAnimationController.lua`:** Handles all button animations and effects.
        *   **`InventoryDataProvider.lua`:** Manages inventory data on the client side.
        *   **`ItemContainerManager.lua`:** Manages the creation and rendering of inventory item UI elements.
        *   **`SearchBarController.lua`:** Manages the search bar functionality.
*   **`StarterPlayer/StarterPlayerScripts`:**
    *   **`InventoryUIManager.lua`:** Manages the inventory UI.
    *   **`StandardModeButton.lua`:** Handles the functionality of a UI button that initiates a teleport.

### `Teleport`

This folder contains all the scripts and modules necessary for the gameplay experience in the teleported place.

*   **`ServerScriptService`:**
    *   **`GameplayManager.lua`:** Manages the gameplay logic.
    *   **`LoadoutManager.lua`:** Retrieves player loadouts from the `MemoryStoreQueue`.
    *   **`PlayerManager.lua`:** Manages loading and saving of player data using `ProfileService`.
    *   **`SecurityManager.lua`:** Consolidates all security-related logic.
    *   **`TeleportManager.lua`:** Handles teleportation requests from clients.
*   **`ReplicatedStorage/Modules`:**
    *   **`GameConfig.lua`:** A single source of truth for all static config and data.
    *   **`GameStateManager.lua`:** Manages the state of each player.
    *   **`Logger.lua`:** Provides a simple and robust logging system.
    *   **`PlayerDataHandler.lua`:** Defines the data structure for player profiles.
    *   **`ProfileService.lua`:** The core `ProfileService` module.
*   **`StarterPlayer/StarterPlayerScripts`:**
    *   **`ReturnToLobby.lua`:** Manages the "Return to Lobby" button.

***

## Main Components

### 1. **ProfileService**
- **Purpose:** A stand-alone ModuleScript that specialises in loading and auto-saving DataStore profiles. This is the core of the "Universe Sharing" data model.
- **Features:** Session-locking, data reconciliation, and auto-saving.

### 2. **PlayerManager**
- **Purpose:** Manages loading and saving of player data using ProfileService.
- **Features:** Handles loading and releasing player profiles when they join and leave the server.

### 3. **SecurityManager**
- **Purpose:** Consolidates all security-related logic.
- **Features:** Nonce generation and validation, inventory and loadout validation, and rate-limiting.

### 4. **GameConfig**
- **Purpose:** A single source of truth for all static config and data, including item templates, admin user IDs, default player data, and teleport mode settings.
- **Features:** Centralized configuration for all game settings.

### 5. **QueueManager**
- **Purpose:** Manages matchmaking/group queueing for team/competitive teleports.
- **Features:** Automatically groups, checks, and teleports pre-validated teams as one.

***

## Data Flow

1.  **Player Joins Lobby:** The `PlayerManager` in the `Lobby` loads the player's profile using `ProfileService`.
2.  **Player Enters Game Place:** The player is teleported to a game place.
3.  **Player Joins Game Place:** The `PlayerManager` in the `Game Place` loads the player's profile. `ProfileService` handles the session lock, ensuring that the `Lobby`'s session is released before the `Game Place`'s session is acquired.
4.  **Player Wins Match:** The `GameplayManager` in the `Game Place` updates the `TotalWins` value directly in the player's profile data.
5.  **Player Returns to Lobby:** The `TeleportManager` in the `Game Place` releases the player's profile using `profile:Release()`. This saves the updated data to the `DataStore` and releases the session lock.
6.  **Player Rejoins Lobby:** The `PlayerManager` in the `Lobby` re-loads the player's profile, which now contains the updated `TotalWins` value.

***

## Troubleshooting

- **Error 267 (security/nonce):**
  Confirm both places are published in the same Roblox universe, and join only through lobby-driven teleport.
- **TeleportData = NO:**
  Means destination place was launched directly, not via teleport.
- **Failed to translate string warning:**
  Harmless Roblox message—ignore.
- **Other issues:**
  Use detailed printouts, confirm PlaceId/GameId, nonce, and session data at each phase; reboot, republish, and always test upgrades live.

***

## Best Practices

- Only ever teleport players from the lobby/main place—never “Play” destination place directly.
- Always validate item ownership both client and server side on future upgrades.
- For complete feature/testing updates, document all new RemoteEvents and loadout validations in this README as you extend.
